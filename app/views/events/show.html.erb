<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>

<h3><%= @event.title %></h3>

<% if can? :update, @event %>
<%= link_to t(:edit), edit_event_path(@event), :class => "btn" %>
<% end %>

<% if can? :destroy, @event %>
  <%= link_to t(:destroy), @event, method: :delete, data: { confirm: t(:confirm_delete) }, :class => "btn" %>
<% end %>
<br>

<% if can? :destroy, @event %>
  <%= link_to "Teilnehmer (#{@event.boxers.count})", participations_path(@event.id) %>
<% end %>

<p>
  <strong><%= t(:club, count: 1) %>:</strong>
  <%= link_to @event.club.name, club_path(@event.club.id) %>
</p>

<p>
  <strong><%= t(:address) %>:</strong>
  <address>
    <%= @event.address %>
  </address>
</p>

<div style='width: 800px;'>
  <div id="map" style='width: 800px; height: 300px;'></div>
</div>

<script type="text/javascript">
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    markers = handler.addMarkers(<%= raw @hash.to_json %>);
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
    handler.getMap().setZoom(15);
  });
</script>

<p>
<strong><%= label_tag :date %>:</strong>
  <%= format_date(@event.date) %>
</p>

<p>
  <strong><%= t(:schedule) %>:</strong></br>
  <% @event.schedule_items.each do |si| %>
    <%= si.label %>:
    <%= format_time(si.time) %></br>
  <% end %>
</p>

<div>
  <strong><%= t(:contact) %></strong>
  <% if @event.contact_name_public %>
  <p>
    <strong><%= t(:name) %>:</strong>
    <%= @event.contact_name %>
  </p>
  <% end %>

  <% if @event.contact_phone_public %>
  <p>
    <strong><%= t(:phone) %>:</strong>
    <%= @event.contact_phone %>
  </p>
  <% end %>

  <% if @event.contact_mail_public %>
  <p>
    <strong><%= t(:mail) %>:</strong>
    <a href="mailto:<%= @event.contact_mail %>"><%= @event.contact_mail %></a>
  </p>
  <% end %>
</div>

<p>
  <strong><%= t(:description) %>:</strong>
  <%= @event.additional_info %>
</p>

<p>
  <strong><%= t(:fee) %>:</strong>
  <%= @event.fee %> €
</p>

<p>
  <strong><%= t(:available) %></strong>
  <ul>
  <% if @event.gloves_available %>
    <li><%= t(:gloves) %></li>
  <% end %>
  <% if @event.catering_available %>
    <li><%= t(:catering) %></li>
  <% end %>
  </ul>
</p>

<p>
  <strong><%= t(:admission) %> (<%= t(:discounted) %>):</strong>
  <%= @event.admission %> € (<%= @event.admission_discounted %> €)
</p>

<p>
  <strong><%= t(:performance_class, count: 2) %>:</strong></br>
  <% @event.performance_classes.each do |pc| %>
    <%= pc.title %></br>
  <% end %>
</p>

<p class="approved">
  <strong>genehmigt?</strong></br>
  <% if @event.approved.nil? then %>
    Offen
  <% elsif @event.approved then %>
    Ja
  <% else %>
    Nein
  <% end %>
</p>

<% if current_user && @event.approved then %>

<div class="participations">
  <div class="apply-button">
    <% if can? :create, Boxer %>
    <%= link_to t(:apply), application_path(@event.id) %>
    <% end %>
  </div>
  
  <% unless @boxers_applied.empty? then %>
    <p>Folgende Boxer sind angemeldet:</p>
    <ul>
      <% @boxers_applied.each do |b| %>
        <li>
        <%= b.first_name %> <%= b.last_name %>
        <%= link_to t(:undo_application), participation_path(b.participations.find_by_event_id(@event.id).id), method: :delete, data: { confirm: t(:confirm_delete) } %>
        </li>
      <% end %>
    </ul>
  <% end %>
</div>

<% end %>

<% if can? :manage, @event and !@event.approved then %>
<div class="approve-buttons form-actions">
  <%= form_for(@event, :remote => true, :class => "approve_form", :html => {:onsubmit => "approve_event()"}) do |f| %>
    <%= f.hidden_field :approved, value: true %>
    <%= f.submit t(:approve), :class => "btn" %>
  <% end %>

  <%= form_for(@event, :remote => true, :class => "approve_form", :html => {:onsubmit => "decline_event()"}) do |f| %>
    <%= f.hidden_field :approved, value: false %>
    <%= f.submit t(:decline), :class => "btn" %>
  <% end %>
</div>
<% end %>

